<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>경영정보시스템 AI 학습 플랫폼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; scroll-behavior: smooth; }
        .view { display: none; }
        .view.active { display: block; }
        .mode-card { transition: all 0.2s ease-in-out; }
        .mode-card:hover { transform: translateY(-8px); box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); }
        .chapter-card.selected { border-color: #4f46e5; background-color: #eef2ff; color: #1e1b4b; }
        .mcq-option.selected { background-color: #e0e7ff; border-color: #4f46e5; }
        .result-card.correct { border-left-color: #16a34a; }
        .result-card.incorrect { border-left-color: #dc2626; }
        .result-card.manual { border-left-color: #f59e0b; }
        #generate-quiz-btn:disabled, #add-ai-questions-btn:disabled { cursor: not-allowed; }
        .learning-nav a.active { color: #4f46e5; font-weight: 700; border-left-color: #4f46e5; }
        .prose h3 { font-size: 1.5rem; font-weight: 700; margin-top: 2.5rem; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e5e7eb; }
        .prose h4 { font-size: 1.15rem; font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.75rem; color: #1e3a8a; }
        .prose ul { list-style-type: disc; padding-left: 1.5rem; }
        .prose li { margin-bottom: 0.5rem; }
        .prose strong { color: #1e40af; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div id="app-container" class="w-full">
        <!-- Main Mode Selection View -->
        <div id="main-view" class="view active min-h-screen flex items-center justify-center p-4">
            <div class="text-center">
                <h1 class="text-5xl font-bold text-slate-900">경영정보시스템 학습 플랫폼</h1>
                <p class="mt-4 text-xl text-slate-600">학습 방법을 선택하세요.</p>
                <div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                    <div id="learning-mode-btn" class="mode-card bg-white p-10 rounded-xl shadow-lg cursor-pointer text-left">
                        <i class="fas fa-book-open text-4xl text-blue-500 mb-4"></i>
                        <h2 class="text-2xl font-bold text-slate-800">학습 모드</h2>
                        <p class="mt-2 text-slate-500">핵심 개념을 체계적으로 학습합니다.</p>
                    </div>
                    <div id="quiz-mode-btn" class="mode-card bg-white p-10 rounded-xl shadow-lg cursor-pointer text-left">
                        <i class="fas fa-pencil-alt text-4xl text-green-500 mb-4"></i>
                        <h2 class="text-2xl font-bold text-slate-800">문제풀이 모드</h2>
                        <p class="mt-2 text-slate-500">AI로 문제를 생성하고 실전처럼 테스트합니다.</p>
                    </div>
                </div>
                 <footer class="text-center py-4 mt-16">
                    <button id="admin-mode-btn" class="text-sm text-slate-400 hover:text-indigo-600">관리자 모드</button>
                </footer>
            </div>
        </div>

        <!-- Learning Mode View -->
        <div id="learning-view" class="view">
            <header class="bg-white shadow-sm sticky top-0 z-20">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-16">
                    <h1 class="text-xl font-bold text-slate-800"><i class="fas fa-book-open text-blue-500 mr-2"></i>학습 모드</h1>
                    <button class="main-home-btn px-4 py-2 bg-slate-200 text-slate-700 rounded-lg font-semibold hover:bg-slate-300 transition text-sm">처음으로</button>
                </div>
            </header>
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 mt-8">
                <div class="lg:flex">
                    <aside class="w-full lg:w-64 lg:mr-8 mb-8 lg:mb-0">
                        <nav class="learning-nav sticky top-24">
                            <h2 class="font-bold text-lg mb-4">학습 챕터</h2>
                            <ul class="space-y-2">
                                <li><a href="#learn-ch5" class="block pl-4 border-l-4 border-transparent text-slate-600 hover:text-indigo-600 hover:border-indigo-600">Chapter 5: 데이터베이스</a></li>
                                <li><a href="#learn-ch6" class="block pl-4 border-l-4 border-transparent text-slate-600 hover:text-indigo-600 hover:border-indigo-600">Chapter 6: BI</a></li>
                                <li><a href="#learn-ch7" class="block pl-4 border-l-4 border-transparent text-slate-600 hover:text-indigo-600 hover:border-indigo-600">Chapter 7: 전사적 시스템</a></li>
                                <li><a href="#learn-ch8" class="block pl-4 border-l-4 border-transparent text-slate-600 hover:text-indigo-600 hover:border-indigo-600">Chapter 8: 경쟁 전략</a></li>
                            </ul>
                        </nav>
                    </aside>
                    <main id="learning-content-container" class="flex-1 bg-white p-8 rounded-lg shadow-md prose max-w-none">
                    </main>
                </div>
            </div>
        </div>

        <!-- Quiz Mode (Home) View -->
        <div id="quiz-home-view" class="view">
             <div class="container mx-auto p-4 sm:p-6 lg:p-8 min-h-screen flex flex-col">
                <header class="text-center mb-8 flex-shrink-0 pt-8">
                    <div class="flex justify-between items-center">
                        <h1 class="text-4xl font-bold text-slate-900">맞춤형 테스트</h1>
                        <button class="main-home-btn px-4 py-2 bg-slate-200 text-slate-700 rounded-lg font-semibold hover:bg-slate-300 transition">처음으로</button>
                    </div>
                    <p class="mt-3 text-lg text-slate-600">시험 볼 챕터를 모두 선택한 후, '문제 출제' 버튼을 누르세요.</p>
                </header>
                <main id="chapter-selection" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 flex-grow">
                </main>
                <div id="quiz-actions" class="mt-10 text-center flex-shrink-0">
                    <div id="ai-status" class="mb-4 text-slate-600 h-6"></div>
                    <div class="flex justify-center items-center gap-4">
                        <button id="add-ai-questions-btn" class="px-8 py-4 bg-blue-600 text-white rounded-lg font-bold text-xl hover:bg-blue-700 transition shadow-lg disabled:bg-blue-300" disabled>
                            <i class="fas fa-magic-wand-sparkles mr-2"></i>AI로 문제 추가
                        </button>
                        <button id="generate-quiz-btn" class="px-10 py-4 bg-indigo-600 text-white rounded-lg font-bold text-xl hover:bg-indigo-700 transition shadow-lg disabled:bg-indigo-300" disabled>
                            문제 출제
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiz View -->
        <div id="quiz-view" class="view">
             <div class="container mx-auto p-4 sm:px-6 lg:p-8">
                <header class="flex justify-between items-center mb-6 pb-4 border-b border-slate-300">
                    <h1 id="quiz-title" class="text-3xl font-bold text-slate-900"></h1>
                    <button id="back-to-quiz-home" class="px-4 py-2 bg-slate-200 text-slate-700 rounded-lg font-semibold hover:bg-slate-300 transition">챕터 선택</button>
                </header>
                <div id="quiz-container" class="space-y-8"></div>
                <div class="mt-10 text-center">
                    <button id="grade-button" class="px-8 py-3 bg-indigo-600 text-white rounded-lg font-bold text-lg hover:bg-indigo-700 transition shadow-lg">채점하기</button>
                </div>
            </div>
        </div>

        <!-- Results View -->
        <div id="results-view" class="view">
            <div class="container mx-auto p-4 sm:px-6 lg:p-8">
                <header class="text-center mb-10">
                    <h1 class="text-4xl font-bold text-slate-900">채점 결과</h1>
                    <p id="results-summary" class="mt-3 text-2xl font-semibold text-indigo-600"></p>
                </header>
                <div id="results-container" class="space-y-6"></div>
                <div class="mt-10 text-center">
                     <button id="restart-quiz" class="px-6 py-3 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition">다시 풀기</button>
                     <button id="go-to-quiz-home" class="ml-4 px-6 py-3 bg-slate-200 text-slate-700 rounded-lg font-bold hover:bg-slate-300 transition">챕터 선택</button>
                </div>
            </div>
        </div>
        
        <!-- Admin View -->
        <div id="admin-view" class="view">
             <div class="container mx-auto p-4 sm:px-6 lg:p-8">
                <header class="text-center mb-8">
                    <h1 class="text-4xl font-bold text-slate-900">관리자 모드</h1>
                    <p class="mt-3 text-lg text-slate-600">문제 데이터를 직접 수정, 추가, 백업할 수 있습니다.</p>
                </header>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-bold mb-2">문제 데이터 (JSON 형식)</h2>
                    <p class="text-sm text-slate-500 mb-4">아래 텍스트를 직접 수정하여 문제를 변경할 수 있습니다. 새로운 문제를 추가하려면 기존 문제의 형식을 복사하여 붙여넣고 내용을 수정하세요.</p>
                    <textarea id="data-editor" class="w-full h-96 p-3 border border-slate-300 rounded-md font-mono text-sm"></textarea>
                    <div class="flex flex-wrap gap-4 mt-4">
                        <button id="save-data-btn" class="px-6 py-2 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 transition">저장하기</button>
                        <button id="download-data-btn" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition">데이터 백업</button>
                        <button onclick="document.getElementById('upload-data-input').click()" class="px-6 py-2 bg-orange-500 text-white rounded-lg font-bold hover:bg-orange-600 transition">데이터 복원</button>
                        <input type="file" id="upload-data-input" class="hidden" accept=".json">
                        <button id="exit-admin-btn" class="px-6 py-2 bg-slate-500 text-white rounded-lg font-bold hover:bg-slate-600 transition">나가기</button>
                    </div>
                    <p id="save-status" class="mt-4 text-green-600 font-semibold"></p>
                </div>
             </div>
        </div>
    </div>
    
    <!-- Modal Layer -->
    <div id="modal-layer" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
         <!-- API Key Modal -->
         <div id="api-key-modal" class="hidden bg-white p-8 rounded-lg shadow-xl w-full max-w-md">
            <h2 class="text-2xl font-bold mb-2">Gemini API 키 입력</h2>
            <p class="text-sm text-slate-500 mb-4">AI 문제 생성을 위해, Google AI Studio에서 발급받은 API 키를 입력해주세요.</p>
            <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-indigo-600 hover:underline text-sm mb-4 block">
                <i class="fas fa-key mr-1"></i>무료 API 키 발급받으러 가기
            </a>
            <input type="password" id="api-key-input" class="w-full p-2 border border-slate-300 rounded-md mb-4" placeholder="AIza...">
            <p id="api-key-error" class="text-red-500 text-sm mb-4 hidden">유효하지 않은 API 키 형식입니다.</p>
            <div class="flex justify-end gap-4">
                <button id="api-key-cancel" class="px-4 py-2 bg-slate-200 rounded-lg font-semibold">취소</button>
                <button id="api-key-submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold">저장 및 생성</button>
            </div>
        </div>
        <!-- Password Modal -->
        <div id="password-modal" class="hidden bg-white p-8 rounded-lg shadow-xl w-full max-w-sm">
            <h2 class="text-2xl font-bold mb-4">관리자 암호 입력</h2>
            <input type="password" id="password-input" class="w-full p-2 border border-slate-300 rounded-md mb-4">
            <p id="password-error" class="text-red-500 text-sm mb-4 hidden">암호가 틀렸습니다.</p>
            <div class="flex justify-end gap-4">
                <button id="password-cancel" class="px-4 py-2 bg-slate-200 rounded-lg font-semibold">취소</button>
                <button id="password-submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold">확인</button>
            </div>
        </div>
    </div>
    
    <script>
    const initialQuestionData = [
         { "id": 1, "type": "주관식", "chapter": "Chapter 05", "text": "현실 세계에 관한 데이터를 컴퓨터에 바로 저장할 수 없기 때문에, 무엇을 어떻게 표현해야 할지 개념적으로 요약하는 과정을 무엇이라고 하는가?", "answer": ["모형화", "Modeling"] },
         { "id": 2, "type": "객관식", "chapter": "Chapter 06", "text": "온라인 거래 처리(OLTP)와 온라인 분석 처리(OLAP)에 대한 비교 설명으로 옳은 것을 모두 고른 것은?", "options": ["가, 나, 다", "가, 다, 라", "나, 다, 라", "가, 나, 다, 라", "정답없음"], "answer": 4, "explanation": "보기 가, 나, 다, 라는 모두 OLTP와 OLAP의 특징을 올바르게 비교한 것이다." },
         { "id": 3, "type": "서술형", "chapter": "Chapter 07", "text": "기존의 마케팅과 CRM(고객관계관리)의 가장 큰 차이점을 '목표'와 '대상'의 관점에서 서술하시오.", "answer": "기존 마케팅은 불특정 다수를 대상으로 상품을 판매하는 것을 목표로 하지만, CRM은 이미 확보된 특정 고객을 대상으로 지속적인 관계를 유지하여 고객의 평생 가치를 극대화하는 것을 목표로 한다." },
         { "id": 4, "type": "주관식", "chapter": "Chapter 08", "text": "어떤 기업이 특정 사업 분야에서 철수하려고 할 때, 그 분야에서 쉽게 빠져나오지 못하게 하는 요인을 무엇이라고 하는가?", "answer": ["철수장벽", "Barriers to Exit"] },
         { "id": 5, "type": "객관식", "chapter": "Chapter 06", "text": "비즈니스 인텔리전스(BI)의 3가지 주요 구성요소로 옳지 않은 것은?", "options": ["데이터 웨어하우스와 같은 데이터 관리 공간", "데이터 마이닝, OLAP과 같은 업무 분석 도구", "대시보드, 시각화 툴과 같은 사용자 인터페이스", "기업 내부 데이터의 정확성을 검증하는 데이터베이스 감사(Audit) 시스템", "정답없음"], "answer": 3, "explanation": "데이터베이스 감사는 일반적인 데이터 관리 활동일 수는 있으나, BI를 구성하는 3대 핵심 요소(데이터 관리, 업무 분석 도구, 사용자 인터페이스)에는 포함되지 않는다." },
         { "id": 6, "type": "주관식", "chapter": "Chapter 06", "text": "BI의 질의 및 보고서 작성 기능에서, 사용자가 요약된 형태의 정보에서 점차 상세한 수준의 정보로 다차원적인 접근을 가능하게 하는 기능을 무엇이라고 하는가?", "answer": ["드릴 다운", "Drill down"] },
         { "id": 7, "type": "주관식", "chapter": "Chapter 06", "text": "데이터 웨어하우스의 한 부분으로, 마케팅이나 판매와 같이 특정 주제나 부서의 데이터에 초점을 맞춘 소규모 데이터 웨어하우스를 (           )(이)라고 한다.", "answer": ["데이터 마트", "Data Mart"] },
         { "id": 8, "type": "주관식", "chapter": "Chapter 08", "text": "마이클 포터가 제시한 세 가지 본원적 경쟁전략은 비용 우위 전략, 차별화 전략, 그리고 (           )이다.", "answer": "집중화 전략" },
         { "id": 9, "type": "주관식", "chapter": "Chapter 06", "text": "기업 내외부에 축적된 데이터를 기반으로 경영 정보를 분석하고 예측하여, 의사결정을 지원하는 정보 시스템 또는 프로세스를 무엇이라고 하는가?", "answer": ["비즈니스 인텔리전스", "Business Intelligence", "BI"] },
         { "id": 10, "type": "주관식", "chapter": "Chapter 07", "text": "의류의 기획, 디자인, 생산, 유통, 판매까지의 전 과정을 제조회사가 직접 관리하는 의류 전문점을 무엇이라고 하는가? (영문 약어로 답변)", "answer": "SPA" },
         { "id": 11, "type": "서술형", "chapter": "Chapter 06", "text": "데이터 웨어하우스의 특징 4가지를 모두 쓰시오.", "answer": "1. 주제 중심의 데이터 (Subject-oriented)<br>2. 통합적 데이터 (Integrated)<br>3. 시간에 따라 데이터가 적재되는 시간 의존적 데이터 (Time-variant)<br>4. 비휘발성 데이터 (Non-volatile)" },
         { "id": 12, "type": "객관식", "chapter": "Chapter 05", "text": "다음 중 데이터베이스 시스템(Database System)의 4가지 구성요소로 올바르게 짝지어진 것은?", "options": ["데이터, 데이터베이스, 데이터베이스 관리시스템(DBMS), 응용 프로그램", "데이터베이스(DB), 데이터베이스 관리시스템(DBMS), 하드웨어, 사용자", "데이터베이스(DB), 데이터베이스 관리시스템(DBMS), 소프트웨어, 사용자", "데이터, 정보, 지식, 데이터베이스", "정답없음"], "answer": 1 },
         { "id": 13, "type": "주관식", "chapter": "Chapter 08", "text": "고객의 니즈(needs)를 충족시켜 고객 만족도를 높이는 데 초점을 맞추는 경쟁 우위 전략을 (           ) 전략이라고 한다.", "answer": "고객 전략" },
         { "id": 14, "type": "주관식", "chapter": "Chapter 06", "text": "사용자가 원하는 결과를 한눈에 볼 수 있도록 그래프, 차트, 표 등을 사용하여 정보를 시각적으로 구성하고 표현하는 BI의 사용자 인터페이스 도구를 무엇이라고 하는가?", "answer": "대시보드 (Dashboard)" },
         { "id": 15, "type": "주관식", "chapter": "Chapter 06", "text": "의사결정 지원을 위해 여러 데이터베이스에서 수집된 데이터를 통합하여 저장하는 공간으로, 과거와 현재 데이터를 모두 포함하며 다차원적 분석이 가능한 구조를 가진 것을 무엇이라고 하는가?", "answer": ["데이터 웨어하우스", "Data Warehouse"] },
         { "id": 16, "type": "객관식", "chapter": "Chapter 08", "text": "마이클 포터의 가치사슬 모형(Value Chain Model)에서 본원적 활동(Primary Activities)에 해당하지 않는 것은?", "options": ["내부 물류", "제조, 생산", "인적 자원 관리", "마케팅, 영업", "정답없음"], "answer": 2, "explanation": "인적 자원 관리는 본원적 활동을 지원하는 지원 활동(Support Activities)에 해당한다." },
         { "id": 17, "type": "주관식", "chapter": "Chapter 05", "text": "여러 개의 데이터베이스 작업으로 이루어진 논리적 작업 단위로, 모든 작업이 성공적으로 수행되든지 아니면 모두 실패하여 원래 상태로 되돌려지는 특징을 갖는 기능을 무엇이라고 하는가?", "answer": "트랜잭션 (Transaction)" },
         { "id": 18, "type": "주관식", "chapter": "Chapter 08", "text": "기존의 정보시스템에 정보기술과 경쟁전략 개념을 융합하여 기업의 경쟁우위를 확보하고 부가가치를 창출하는 시스템을 무엇이라고 하는가? (영문 약어로도 가능)", "answer": ["전략정보시스템", "Strategic Information System", "SIS"] },
         { "id": 19, "type": "주관식", "chapter": "Chapter 05", "text": "개체-관계 다이어그램(ERD)에서, 관계의 '전체 참여'는 ( A )(으)로, '부분 참여'는 ( B )(으)로 표기한다.", "answer": "A: 두 줄, B: 한 줄" },
         { "id": 20, "type": "주관식", "chapter": "Chapter 07", "text": "기업 내 생산, 물류, 재무, 회계, 구매, 재고 등 경영 활동의 프로세스들을 통합적으로 연계해 관리하여, 기업의 정보들을 공유하고 빠른 의사결정을 지원하는 시스템을 (           )(이)라고 한다.", "answer": ["전사적자원관리", "Enterprise Resource Planning", "ERP"] },
         { "id": 21, "type": "주관식", "chapter": "Chapter 05", "text": "데이터베이스 내의 데이터가 허가되지 않은 방법으로 입력되거나 수정될 수 없도록 보호하여 유효성을 유지하는 성질을 무엇이라고 하는가?", "answer": ["데이터 무결성", "Integrity"] },
         { "id": 22, "type": "객관식", "chapter": "Chapter 06", "text": "데이터 마이닝의 기법에 대한 설명으로 가장 옳지 않은 것은?", "options": ["**연관성 분석:** '기저귀와 맥주' 사례처럼, 데이터 사이에 존재하는 연관 규칙을 발견하는 기법이다.", "**군집 분석:** 데이터의 특징을 기준으로 유사한 항목들을 그룹으로 묶는 기법이다.", "**예측 모델링:** 데이터의 과거 패턴을 기반으로 미래의 특정 속성 값을 예측하는 모델을 만든다.", "**이상치 탐지:** 데이터의 전체적인 분포를 파악하여 데이터의 평균과 표준편차를 구하는 기법이다.", "정답없음"], "answer": 3, "explanation": "이상치 탐지(Anomaly Detection)는 기존 데이터 패턴과 상이한, 즉 특이한 데이터를 찾아내는 기법이다. 데이터의 평균이나 표준편차를 구하는 것은 일반적인 통계 분석에 해당한다." },
         { "id": 23, "type": "서술형", "chapter": "Chapter 08", "text": "정보기술을 이용해 획득한 기업의 경쟁우위가 장기간 지속되기 어려운 이유와, 그럼에도 불구하고 시장에 먼저 진입한 기업이 얻는 이점은 무엇인지 서술하시오.", "answer": "정보기술을 이용한 경쟁우위는 경쟁사들이 유사한 기술이나 시스템을 빠르게 모방하여 도입할 수 있기 때문에 장기간 지속되기 어렵다. 그럼에도 불구하고, 시장에 먼저 진입한 기업은 다수의 신규 고객을 확보하고 혁신적인 시장 리더라는 이미지를 얻는 추가적인 이점을 누릴 수 있다." },
         { "id": 24, "type": "주관식", "chapter": "Chapter 05", "text": "각 업무별로 필요한 파일을 사용자가 직접 프로그램을 통해 관리하던 초기의 데이터 처리 방식을 무엇이라고 하는가?", "answer": "파일 처리 시스템 (File Processing System)" },
         { "id": 25, "type": "주관식", "chapter": "Chapter 07", "text": "CRM의 주요 기능 중, 기존에 특정 상품을 구매했던 고객에게 업그레이드된 상위 상품의 구매를 유도하는 판매 방법을 무엇이라고 하는가?", "answer": "업셀링 (Up-Selling)" },
         { "id": 26, "type": "주관식", "chapter": "Chapter 05", "text": "개체-관계 모델에서, 다른 개체에 독립적으로 존재하지 못하고 상위 개체(정규 개체)가 있어야만 존재할 수 있는 개체를 무엇이라고 하는가?", "answer": "약한 개체 (Weak Entity)" },
         { "id": 27, "type": "주관식", "chapter": "Chapter 08", "text": "기업의 전통적인 운영 방식을 새로운 방식으로 획기적으로 바꾸거나, 새로운 제품 및 서비스를 개발하는 경쟁 우위 전략을 무엇이라고 하는가?", "answer": ["혁신 전략", "Innovation Strategy"] },
         { "id": 28, "type": "객관식", "chapter": "Chapter 08", "text": "다음 중 가치사슬 모형의 지원 활동(Support Activities)에 해당하지 **않는** 것은?", "options": ["조달 활동", "기술 개발", "인적 자원 관리", "기업 하부구조", "정답없음"], "answer": 4, "explanation": "보기 ①, ②, ③, ④는 모두 가치사슬 모형의 지원 활동에 해당하므로, '해당하지 않는 것'은 없다." },
         { "id": 29, "type": "객관식", "chapter": "Chapter 08", "text": "마이클 포터의 5가지 경쟁세력 모형(Five Forces Model)에 포함되지 않는 것은?", "options": ["신규 진입 기업의 위협", "공급자의 교섭력", "구매자의 교섭력", "정부의 정책 및 규제", "정답없음"], "answer": 3, "explanation": "정부의 정책 및 규제는 기업 환경에 영향을 주는 중요한 요인이지만, 포터의 5가지 경쟁세력 모형에는 직접적으로 포함되지 않는다." },
         { "id": 30, "type": "서술형", "chapter": "Chapter 07", "text": "공급사슬관리 기법 중 ECR과 QR의 차이점을 각각 적용되는 '산업 분야'를 중심으로 서술하시오.", "answer": "ECR(Efficient Consumer Response)은 주로 식품 산업의 공급업체와 유통업체 간의 협력에 적용되는 기법이다. 반면, QR(Quick Response)은 주로 의류 산업에서 소비자의 다양한 욕구를 신속하게 파악하여 제품을 공급하는 방식에 적용된다." },
         { "id": 31, "type": "객관식", "chapter": "Chapter 08", "text": "마이클 포터의 본원적 경쟁전략에 대한 설명으로 가장 **옳지 않은** 것은?", "options": ["**비용 우위 전략**은 산업 전반의 넓은 시장을 대상으로 원가 절감을 통해 경쟁 우위를 확보하는 것이다.", "**차별화 전략**은 제품이나 서비스에 독특한 가치를 부여하여 경쟁사와 구별되게 만드는 전략이다.", "**집중화 전략**은 특정 세분시장(틈새시장)에 경영 자원을 집중하여 경쟁 우위를 확보하는 것이다.", "**원가 집중화 전략**은 산업 전반의 모든 구매자를 대상으로 가장 낮은 가격을 제공하는 데 집중하는 전략이다.", "정답없음"], "answer": 3, "explanation": "원가 집중화 전략은 '산업 전반의 모든 구매자'가 아닌 '좁은 범위의 특정 구매자 집단(틈새시장)'을 대상으로 저비용을 추구하는 전략이다." },
         { "id": 32, "type": "주관식", "chapter": "Chapter 07", "text": "기업이 고객과 관련된 내·외부 자료를 분석·통합하여 고객 특성에 맞게 마케팅 활동을 지원하고, 고객과의 지속적인 관계를 유지하여 고객 가치를 극대화하는 시스템을 (           )(이)라고 한다.", "answer": ["고객관계관리", "Customer Relationship Management", "CRM"] },
         { "id": 33, "type": "주관식", "chapter": "Chapter 08", "text": "가치사슬 모형에서, 본원적 활동이 원활히 이루어지도록 간접적으로 지원하는 4가지 활동은 조달 활동, 기술 개발, 인적 자원 관리, 그리고 (           )이다.", "answer": "기업 하부구조 (Firm Infrastructure)" },
         { "id": 34, "type": "서술형", "chapter": "Chapter 06", "text": "OLTP(온라인 거래 처리)와 OLAP(온라인 분석 처리)의 차이점을 '목적'과 '사용 데이터'의 관점에서 서술하시오.", "answer": "**목적:** OLTP는 일상의 반복적인 거래 업무를 빠르고 효율적으로 처리하는 것이 목적이지만, OLAP은 사용자가 복잡하고 다양한 질문에 대해 분석하여 의사결정을 지원하는 것이 목적이다.<br>**사용 데이터:** OLTP는 주로 실시간으로 갱신되는 운영 데이터베이스(DB)를 사용하고, OLAP은 의사결정을 위해 과거 데이터까지 통합된 데이터 웨어하우스(DW)나 데이터 마트의 데이터를 사용한다." },
         { "id": 35, "type": "주관식", "chapter": "Chapter 06", "text": "온라인 분석 처리(OLAP)에서 다차원적인 데이터를 분석하기 위한 두 가지 기법은 (           )와/과 (           )이다.", "answer": "다이스(Dice), 슬라이스(Slice)" },
         { "id": 36, "type": "주관식", "chapter": "Chapter 08", "text": "고객이 한 공급자에서 다른 공급자로 거래처를 변경할 때 발생하는 경제적·시간적 비용을 (           )(이)라고 한다.", "answer": ["전환비용", "Switching Cost"] },
         { "id": 37, "type": "서술형", "chapter": "Chapter 06", "text": "데이터 마이닝의 4가지 기법을 쓰시오.", "answer": "1. 연관 분석 (Association Analysis)<br>2. 군집 분석 (Cluster Analysis)<br>3. 예측 모델링 (Predictive Modeling)<br>4. 이상치 탐지 (Anomaly Detection)" },
         { "id": 38, "type": "주관식", "chapter": "Chapter 05", "text": "데이터베이스 관리시스템(DBMS)의 종류를 2가지 쓰시오.", "answer": "ORACLE(오라클), MySQL" },
         { "id": 39, "type": "주관식", "chapter": "Chapter 08", "text": "기업의 경쟁전략을 설명하는 마이클 포터의 3가지 개념은 경쟁세력 모형, 본원적 전략, 그리고 (           ) 모형이다.", "answer": "가치사슬" },
         { "id": 40, "type": "주관식", "chapter": "Chapter 07", "text": "정보기술을 이용하여 기업의 업무 흐름을 분석하고 최적화함으로써 반복적이거나 불필요한 과정을 제거하는 경영혁신 기법을 무엇이라고 하는가? (영문 약어로도 가능)", "answer": ["업무 재설계", "Business Process Reengineering", "BPR"] },
         { "id": 41, "type": "주관식", "chapter": "Chapter 05", "text": "개체-관계 모델에서, 관계에 참여하는 개체 타입의 모든 구성원이 관계에 참여하는 것을 ( A )(이)라고 하고, 일부 구성원만 참여하는 것을 ( B )(이)라고 한다.", "answer": "A: 전체 참여, B: 부분 참여" },
         { "id": 42, "type": "주관식", "chapter": "Chapter 06", "text": "디지털 환경에서 생성되는 데이터로 그 규모가 방대하고, 생성 주기가 짧으며, 수치뿐 아니라 문자와 영상 등 비정형 데이터를 포함하는 대규모 데이터를 (           )(이)라고 한다.", "answer": "빅데이터 (Big Data)" },
         { "id": 43, "type": "주관식", "chapter": "Chapter 08", "text": "내부 업무의 프로세스를 개선하여 동종 경쟁사에 비해 업무를 더 쉽고 생산적으로 수행하도록 하는 경쟁 우위 전략을 (           ) 전략이라고 한다.", "answer": ["운영효과성 전략", "Operational Effectiveness Strategy"] },
         { "id": 44, "type": "객관식", "chapter": "Chapter 07", "text": "다음 중 전사적자원관리(ERP) 시스템의 주요 특징으로 가장 거리가 **먼** 것은?", "options": ["업무 프로세스의 통합화", "BPR(업무 재설계) 실현", "글로벌화에 대한 대응", "시스템의 폐쇄성 및 종속성", "정답없음"], "answer": 3, "explanation": "ERP 시스템은 특정 하드웨어와 운영체제에 의존하지 않는 개방성(Openness)을 특징으로 하여 확장 및 연계가 용이하다." },
         { "id": 45, "type": "주관식", "chapter": "Chapter 07", "text": "제품이나 정보가 생산자에서부터 최종 소비자에게 이르는 자재 조달, 제품 생산, 유통, 판매의 전 과정을 최적화하여 효율적인 처리를 지원하는 시스템을 (           )(이)라고 한다.", "answer": ["공급사슬관리", "Supply Chain Management", "SCM"] },
         { "id": 46, "type": "객관식", "chapter": "Chapter 05", "text": "개체-관계 다이어그램(ERD)의 구성요소 표기법으로 옳지 않은 것은?", "options": ["개체(Entity)는 직사각형으로 표현한다.", "관계(Relationship)는 마름모로 표현한다.", "속성(Attribute)은 타원형으로 표현한다.", "전체 참여(Total Participation)는 한 줄 실선으로 표현한다.", "정답없음"], "answer": 3, "explanation": "전체 참여는 두 줄 실선으로, 부분 참여는 한 줄 실선으로 표현한다." },
         { "id": 47, "type": "주관식", "chapter": "Chapter 06", "text": "데이터 항목 간의 연관성 규칙을 발견하는 연관성 분석은 월마트의 구매 패턴 분석 사례로 인해 다른 말로 '(           ) 분석'이라고도 불린다.", "answer": "장바구니 분석" },
         { "id": 48, "type": "주관식", "chapter": "Chapter 06", "text": "일상의 반복적인 업무를 수행하는 시스템에서 데이터를 조회하거나 저장하는 등의 작업을 처리하는 방식을 (           )(이)라고 한다. (영문 약어로 답변)", "answer": "OLTP" },
         { "id": 49, "type": "주관식", "chapter": "Chapter 07", "text": "CRM의 주요 기능 중, 기존 상품을 구매한 고객이 그 상품과 연관된 다른 상품을 구매하도록 유도하는 판매 방법을 (           )(이)라고 한다.", "answer": "교차판매 (Cross-Selling)" },
         { "id": 50, "type": "주관식", "chapter": "Chapter 05", "text": "사용자나 응용 프로그램이 데이터베이스에 접근하여 데이터를 정의, 조작, 제어할 수 있도록 해주는 소프트웨어를 무엇이라고 하는가?", "answer": ["데이터베이스 관리시스템", "DBMS"] },
         { "id": 51, "type": "주관식", "chapter": "Chapter 07", "text": "기업이 고객과 관련된 내·외부 자료를 분석·통합하여 고객 특성에 맞게 마케팅 활동을 지원하고, 고객과의 지속적인 관계를 유지하여 고객 가치를 극대화하는 시스템을 (           )(이)라고 한다.", "answer": ["고객관계관리", "Customer Relationship Management", "CRM"] }
    ];

    const learningContent = {
        'Chapter 05': {
            title: 'Chapter 5: 데이터베이스 관리',
            content: `
                <h3>1. 데이터베이스 기본 개념</h3>
                <h4>데이터 (Data)</h4>
                <ul>
                    <li>현실세계의 사물이나 사건을 관찰 또는 측정하여 얻는 사실(Fact) 그 자체.</li>
                    <li>예: 제품 재고량, 제품 판매량, 영수증, 숫자, 문자, 사진 등.</li>
                </ul>
                <h4>데이터베이스 (Database, DB)</h4>
                <ul>
                    <li>여러 응용 프로그램들이 공동으로 사용하기 위해 통합, 저장된 데이터의 집합. 데이터 중복을 최소화.</li>
                </ul>
                <h4>데이터베이스 관리시스템 (DBMS)</h4>
                <ul>
                    <li>사용자 또는 응용프로그램이 데이터베이스 작업을 하기 위해 사용하는 소프트웨어.</li>
                    <li>예: ORACLE, MySQL.</li>
                </ul>
                <h4>데이터베이스 시스템 (Database System)</h4>
                <ul>
                    <li>데이터를 컴퓨터에 저장하여 사용자로 하여금 필요할 때 데이터를 수정하거나 검색할 수 있게 하는 전체 시스템.</li>
                    <li><strong>구성요소:</strong> 데이터베이스(DB), DBMS, 하드웨어, 사용자.</li>
                </ul>
                <hr class="my-6">
                <h3>2. 데이터베이스 시스템의 특징</h3>
                <ul>
                    <li><strong>데이터 중복 통제:</strong> 데이터를 통합하여 관리하므로 데이터 중복 문제를 해결하고 최소화함.</li>
                    <li><strong>데이터 독립성 확보:</strong> 데이터와 응용 프로그램이 서로 영향을 받지 않음. 데이터 구조가 변경돼도 프로그램은 동일하게 작동.</li>
                    <li><strong>데이터 동시 공유:</strong> DBMS의 동시성 제어(Concurrency Control) 기능으로 여러 응용프로그램이 동시에 동일한 데이터베이스에 접근하여 작업 가능.</li>
                    <li><strong>데이터 보안 향상:</strong> DBMS의 보안 기능으로 권한이 없는 사용자의 접근을 통제 가능.</li>
                    <li><strong>데이터 무결성 유지:</strong> 허가되지 않은 방법으로 데이터가 변경되지 않도록 보호. (유효성 검사)</li>
                    <li><strong>표준화 강화:</strong> 중앙 통제 방식으로 데이터의 양식, 내용, 처리 방식 등에 관한 표준화 적용 용이.</li>
                    <li><strong>트랜잭션(Transaction) 지원:</strong> 여러 개의 DB 작업으로 이루어진 논리적 작업 단위가 전부 성공적으로 수행되거나, 하나라도 실패하면 원래 상태로 되돌리는 기능(All-or-Nothing) 보장.</li>
                </ul>
                <hr class="my-6">
                <h3>3. 데이터 모형화 (개체-관계 모델)</h3>
                <ul>
                    <li><strong>모형화 (Modeling):</strong> 현실 세계 데이터를 컴퓨터에 저장하기 위해 개념적으로 요약하는 과정.</li>
                    <li><strong>개체-관계 모델 (E-R Model):</strong> 현실 세계를 <strong>개체(Entity)</strong>와 그 개체들 간의 <strong>관계(Relationship)</strong>로 표현하는 모델.</li>
                    <li><strong>개체 (Entity):</strong> 구별 가능한 현실 세계의 객체 또는 대상. (예: 학생, 과목, 부서)</li>
                    <li><strong>관계 (Relationship):</strong> 개체들 간의 연관성. (예: 학생과 과목의 '수강' 관계)</li>
                    <li><strong>속성 (Attribute):</strong> 개체나 관계를 설명하는 항목. (예: 학생 개체의 '학번', '이름' 속성)</li>
                    <li><strong>참여도 (Participation):</strong> 관계에 개체가 참여하는 정도. <strong>전체 참여(두 줄)</strong>는 모두 참여, <strong>부분 참여(한 줄)</strong>는 일부만 참여.</li>
                </ul>
            `
        },
        'Chapter 06': {
            title: 'Chapter 6: Business Intelligence',
            content: `
                <h3>1. BI 기본 개념</h3>
                <ul>
                    <li><strong>비즈니스 인텔리전스 (BI):</strong> 기업 내외부의 데이터를 이용해 경영 분석, 예측, 의사결정을 지원하는 정보 시스템 또는 프로세스.</li>
                    <li><strong>BI의 3가지 구성요소:</strong>
                        <ol class="list-decimal pl-5 mt-2">
                            <li><strong>데이터 관리:</strong> 데이터를 저장하고 관리. (예: <strong>데이터 웨어하우스</strong>)</li>
                            <li><strong>업무 분석 도구 (Business Analytics):</strong> 저장된 데이터를 분석. (예: <strong>데이터 마이닝, OLAP</strong>)</li>
                            <li><strong>사용자 인터페이스:</strong> 분석 결과를 시각적으로 제공. (예: <strong>대시보드</strong>)</li>
                        </ol>
                    </li>
                </ul>
                <hr class="my-6">
                <h3>2. 데이터 관리</h3>
                <ul>
                    <li><strong>데이터 웨어하우스 (DW):</strong> 의사결정 지원을 위해 여러 데이터를 주제 중심으로 통합 저장하는 공간.</li>
                    <li><strong>DW의 4가지 특징:</strong>
                        <ul class="list-disc pl-5 mt-2">
                            <li><strong>주제 중심 (Subject-oriented):</strong> 판매, 고객 등 특정 주제 중심으로 데이터 구성.</li>
                            <li><strong>통합적 (Integrated):</strong> 여러 데이터를 통합하여 일관된 형식으로 저장.</li>
                            <li><strong>시간 의존적 (Time-variant):</strong> 시간의 흐름에 따른 변화 추적(추세 분석)이 가능하도록 과거 데이터 축적.</li>
                            <li><strong>비휘발성 (Non-volatile):</strong> 데이터가 수정되거나 삭제되지 않고 읽기 전용으로 사용.</li>
                        </ul>
                    </li>
                    <li><strong>데이터 마트 (Data Mart):</strong> 특정 주제나 부서에 초점을 맞춘 소규모 데이터 웨어하우스.</li>
                </ul>
                <hr class="my-6">
                <h3>3. 업무 분석 도구</h3>
                <ul>
                    <li><strong>데이터 마이닝 (Data Mining):</strong> 대량의 데이터 속에서 숨겨진 패턴과 규칙을 찾아내는 기술.
                        <ul class="list-disc pl-5 mt-2">
                            <li><strong>연관 분석:</strong> 데이터 간의 연관성 규칙 발견. (예: 장바구니 분석)</li>
                            <li><strong>군집 분석:</strong> 유사한 특징을 가진 데이터들을 그룹으로 묶음. (예: 고객 세분화)</li>
                            <li><strong>예측 모델링:</strong> 과거 패턴 기반으로 미래 값을 예측하는 모델 생성.</li>
                            <li><strong>이상치 탐지:</strong> 기존 패턴과 상이한 데이터 탐지. (예: 카드 도난 사용)</li>
                        </ul>
                    </li>
                    <li><strong>OLAP (Online Analytical Processing):</strong> 사용자가 다차원 데이터를 직접 대화식으로 분석하는 방식. (의사결정 지원용)</li>
                    <li><strong>OLTP (Online Transaction Processing):</strong> 일상의 반복적인 거래 업무를 처리하는 방식. (거래 처리용)</li>
                </ul>
            `
        },
        'Chapter 07': {
            title: 'Chapter 7: 전사적 시스템',
            content: `
                <h3>1. ERP (전사적자원관리)</h3>
                <ul>
                    <li><strong>ERP (Enterprise Resource Planning):</strong> 생산, 물류, 재무 등 기업의 모든 경영 활동 프로세스를 통합 관리하는 시스템.</li>
                    <li><strong>BPR (업무 재설계):</strong> ERP 도입 과정에서 기업은 시스템에 맞춰 비효율적인 업무 프로세스를 재설계함.</li>
                    <li><strong>발전 과정:</strong> MRP(자재소요량계획) → MRP II(생산자원계획) → ERP(전사적자원관리) 순으로 발전.</li>
                </ul>
                <hr class="my-6">
                <h3>2. SCM (공급사슬관리)</h3>
                <ul>
                    <li><strong>SCM (Supply Chain Management):</strong> 자재 조달부터 생산, 유통, 판매까지 공급망 전체를 최적화하는 시스템.</li>
                    <li><strong>SPA:</strong> 기획부터 판매까지 모든 과정을 직접 관리하는 의류 전문점. 소비자의 요구를 빠르게 반영.</li>
                    <li><strong>ECR (Efficient Consumer Response):</strong> 주로 <strong>식품 산업</strong>에서 사용되는 SCM 기법.</li>
                    <li><strong>QR (Quick Response):</strong> 주로 <strong>의류 산업</strong>에서 사용되는 SCM 기법.</li>
                </ul>
                <hr class="my-6">
                <h3>3. CRM (고객관계관리)</h3>
                <ul>
                    <li><strong>CRM (Customer Relationship Management):</strong> 고객 데이터를 분석하여 고객과의 장기적 관계를 유지하는 시스템. (기존 고객 관리에 초점)</li>
                    <li><strong>교차판매 (Cross-Selling):</strong> 특정 상품 구매 고객에게 연관 상품 추천.</li>
                    <li><strong>업셀링 (Up-Selling):</strong> 고객이 구매하려는 상품보다 상위 모델 구매를 유도.</li>
                </ul>
            `
        },
        'Chapter 08': {
            title: 'Chapter 8: 경쟁전략과 전략정보시스템',
            content: `
                <h3>1. SIS (전략정보시스템)</h3>
                <ul>
                    <li><strong>SIS (Strategic Information System):</strong> 기업의 경쟁우위 확보를 위해, 기존 정보시스템에 정보기술과 경쟁전략 개념을 융합한 시스템.</li>
                </ul>
                <hr class="my-6">
                <h3>2. 마이클 포터의 경쟁전략 모형</h3>
                <h4>5가지 경쟁세력 모형</h4>
                <ul>
                    <li>산업의 구조적 매력도를 결정하는 5가지 외부 요인 분석 틀.</li>
                    <li><strong>5가지 세력:</strong> ① 산업 내 경쟁, ② 신규 진입자 위협, ③ 대체재 위협, ④ 구매자 교섭력, ⑤ 공급자 교섭력.</li>
                </ul>
                <h4>본원적 경쟁전략</h4>
                <ul>
                    <li>경쟁 우위를 차지하기 위한 3가지 기본 전략.</li>
                    <li><strong>비용 우위 전략:</strong> 경쟁사보다 낮은 원가로 승부.</li>
                    <li><strong>차별화 전략:</strong> 독특한 가치를 부여하여 차별화.</li>
                    <li><strong>집중화 전략:</strong> 특정 틈새시장에 역량 집중.</li>
                </ul>
                <h4>가치사슬 모형</h4>
                <ul>
                    <li>기업의 가치 창출 활동을 분석하는 도구.</li>
                    <li><strong>본원적 활동:</strong> 부가가치 창출에 직접 기여. (예: 생산, 마케팅)</li>
                    <li><strong>지원 활동:</strong> 본원적 활동을 간접 지원. (예: 인적자원관리, 기술개발)</li>
                </ul>
                <hr class="my-6">
                <h3>3. 기타 경쟁 우위 전략</h3>
                <ul>
                    <li><strong>혁신 전략:</strong> 새로운 제품을 개발하거나 운영 방식을 획기적으로 변경.</li>
                    <li><strong>운영효과성 전략:</strong> 내부 프로세스를 개선하여 경쟁사보다 효율적으로 업무 수행.</li>
                </ul>
            `
        }
    };

    let questionData = [];
    const ADMIN_PASSWORD = 'mis';
    let sessionApiKey = null;

    const state = {
        currentView: 'main',
        selectedChapters: [],
        currentQuizQuestions: [],
        userAnswers: {}
    };

    // --- All UI elements ---
    const views = {
        main: document.getElementById('main-view'),
        learning: document.getElementById('learning-view'),
        quizHome: document.getElementById('quiz-home-view'),
        quiz: document.getElementById('quiz-view'),
        results: document.getElementById('results-view'),
        admin: document.getElementById('admin-view')
    };

    const learningContentContainer = document.getElementById('learning-content-container');
    const chapterSelectionContainer = document.getElementById('chapter-selection');
    const generateQuizBtn = document.getElementById('generate-quiz-btn');
    const addAiQuestionsBtn = document.getElementById('add-ai-questions-btn');
    const aiStatus = document.getElementById('ai-status');
    const quizContainer = document.getElementById('quiz-container');
    const resultsContainer = document.getElementById('results-container');
    const dataEditor = document.getElementById('data-editor');
    const quizTitle = document.getElementById('quiz-title');
    const gradeButton = document.getElementById('grade-button');
    const resultsSummary = document.getElementById('results-summary');
    const modalLayer = document.getElementById('modal-layer');
    const apiKeyModal = document.getElementById('api-key-modal');
    const apiKeyInput = document.getElementById('api-key-input');
    const apiKeyError = document.getElementById('api-key-error');

    function showView(viewId) {
        Object.values(views).forEach(v => {
            if(v) v.classList.remove('active');
        });
        if(views[viewId]) {
            views[viewId].classList.add('active');
        }
        state.currentView = viewId;
        window.scrollTo(0, 0);
    }
    
    function setupLearningMode() {
        let contentHTML = '';
        for (const chapterKey in learningContent) {
            const chapter = learningContent[chapterKey];
            contentHTML += `
                <section id="learn-${chapterKey.toLowerCase().replace(/ /g, '-')}" class="mb-12">
                    <h2 class="text-3xl font-bold mb-6 pb-2 border-b">${chapter.title}</h2>
                    <div>${chapter.content}</div>
                </section>
            `;
        }
        learningContentContainer.innerHTML = contentHTML;
        setupLearningNav();
    }

    function setupLearningNav() {
        const navLinks = document.querySelectorAll('.learning-nav a');
        const sections = document.querySelectorAll('#learning-content-container section');

        if(sections.length === 0) return;

        const observer = new IntersectionObserver((entries) => {
            let activeSectionId = null;
            for(const entry of entries) {
                if (entry.isIntersecting) {
                    activeSectionId = entry.target.id;
                    break;
                }
            }
            
            navLinks.forEach(link => {
                const linkHref = link.getAttribute('href');
                link.classList.toggle('active', linkHref === `#${activeSectionId}`);
            });
        }, { rootMargin: "-40% 0px -60% 0px", threshold: 0.1 });

        sections.forEach(section => observer.observe(section));
    }
    
    function handleAiQuestionAddition() {
        if (sessionApiKey) {
            generateAiQuizQuestions(sessionApiKey);
        } else {
            modalLayer.classList.remove('hidden');
            apiKeyModal.classList.remove('hidden');
            apiKeyInput.focus();
        }
    }

    async function generateAiQuizQuestions(apiKey) {
        if (state.selectedChapters.length === 0) return;

        addAiQuestionsBtn.disabled = true;
        generateQuizBtn.disabled = true;
        aiStatus.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i>AI가 선택된 챕터의 문제들을 생성 중입니다... (챕터당 1~2분 소요)`;

        let newQuestionsCount = 0;
        let highestId = questionData.reduce((maxId, q) => Math.max(q.id, maxId), 0);

        try {
            for (const chapterKey of state.selectedChapters) {
                aiStatus.innerHTML = `<i class="fas fa-spinner fa-spin mr-2"></i><b>${chapterKey}</b> 챕터 문제 생성 중...`;
                const concepts = learningContent[chapterKey].content.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();
                const prompt = `경영정보시스템의 다음 핵심 개념들을 바탕으로, 실제 기업 사례를 적용하거나 개념을 응용하는 문제 10개를 생성해줘. 문제는 기존 문제와 겹치지 않게, 그리고 객관식, 주관식, 서술형이 적절히 섞이도록 해줘.

                핵심 개념: "${concepts}"

                출력 형식은 반드시 다음 JSON 구조의 배열(array) 형태여야 해:
                [
                  { "type": "객관식", "chapter": "${chapterKey}", "text": "...", "options": ["...", "...", "...", "..."], "answer": 0~4, "explanation": "..." },
                  { "type": "주관식", "chapter": "${chapterKey}", "text": "...하는 것은 ( )이다.", "answer": ["..."] },
                  { "type": "서술형", "chapter": "Chapter 07", "text": "...", "answer": "..." }
                ]
                `;

                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorBody = await response.text();
                    throw new Error(`[${chapterKey}] API 요청 실패: ${response.status}. ${errorBody}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0]) {
                    const rawText = result.candidates[0].content.parts[0].text;
                    const cleanedText = rawText.replace(/^```json\s*|```\s*$/g, '').trim();
                    const newQuestions = JSON.parse(cleanedText);

                    if (Array.isArray(newQuestions)) {
                        newQuestions.forEach(q => {
                            highestId++;
                            q.id = highestId;
                            q.chapter = chapterKey; // Ensure chapter is correct
                            questionData.push(q);
                        });
                        newQuestionsCount += newQuestions.length;
                    }
                } else {
                    throw new Error(`[${chapterKey}] AI로부터 유효한 응답을 받지 못했습니다.`);
                }
            }
            aiStatus.innerHTML = `<span class="text-green-600 font-bold"><i class="fas fa-check-circle mr-2"></i>총 ${newQuestionsCount}개의 AI 문제가 성공적으로 추가되었습니다!</span>`;
            createChapterCards(); // Refresh chapter cards with new counts
        } catch (error) {
            console.error("AI Question Generation Error:", error);
            aiStatus.innerHTML = `<span class="text-red-600 font-bold"><i class="fas fa-exclamation-triangle mr-2"></i>문제 생성 중 오류가 발생했습니다: ${error.message}</span>`;
        } finally {
            addAiQuestionsBtn.disabled = false;
            generateQuizBtn.disabled = state.selectedChapters.length === 0;
        }
    }


    function toggleChapterSelection(chapter, cardElement) {
        const index = state.selectedChapters.indexOf(chapter);
        if (index > -1) {
            state.selectedChapters.splice(index, 1);
            cardElement.classList.remove('selected');
        } else {
            state.selectedChapters.push(chapter);
            cardElement.classList.add('selected');
        }
        const isDisabled = state.selectedChapters.length === 0;
        generateQuizBtn.disabled = isDisabled;
        addAiQuestionsBtn.disabled = isDisabled;
    }

    function createChapterCards() {
        const chapters = [...new Set(questionData.map(q => q.chapter))].sort();
        chapterSelectionContainer.innerHTML = '';
        chapters.forEach((chapter) => {
            const questionCount = questionData.filter(q => q.chapter === chapter).length;
            const card = document.createElement('div');
            card.className = `chapter-card p-6 rounded-lg text-slate-800 bg-white shadow-sm cursor-pointer`;
            card.dataset.chapter = chapter;
            card.innerHTML = `<h3 class="text-xl font-bold">${chapter.replace('Chapter 0', 'Chapter ')}</h3><p class="mt-2 text-slate-500">${questionCount} 문제</p>`;
            card.addEventListener('click', () => toggleChapterSelection(chapter, card));
            chapterSelectionContainer.appendChild(card);
        });
    }
    
    function startQuiz() {
        if (state.selectedChapters.length === 0) return;
        state.userAnswers = {};
        const questions = questionData.filter(q => state.selectedChapters.includes(q.chapter));
        state.currentQuizQuestions = questions.sort(() => Math.random() - 0.5);
        const chapterNames = state.selectedChapters.map(c => c.replace('Chapter 0', '')).sort().join(', ');
        quizTitle.textContent = `Chapter ${chapterNames} 종합 테스트`;
        renderQuizQuestions();
        showView('quiz');
    }

    function renderQuizQuestions() {
        if (!document.getElementById('quiz-container')) {
             document.getElementById('quiz-view').innerHTML = `
                <div class="container mx-auto p-4 sm:px-6 lg:p-8">
                    <header class="flex justify-between items-center mb-6 pb-4 border-b border-slate-300">
                        <h1 id="quiz-title" class="text-3xl font-bold text-slate-900"></h1>
                        <button id="back-to-quiz-home" class="px-4 py-2 bg-slate-200 text-slate-700 rounded-lg font-semibold hover:bg-slate-300 transition">챕터 선택</button>
                    </header>
                    <div id="quiz-container" class="space-y-8"></div>
                    <div class="mt-10 text-center">
                        <button id="grade-button" class="px-8 py-3 bg-indigo-600 text-white rounded-lg font-bold text-lg hover:bg-indigo-700 transition shadow-lg">채점하기</button>
                    </div>
                </div>`;
            document.getElementById('back-to-quiz-home').addEventListener('click', () => showView('quiz-home'));
            document.getElementById('grade-button').addEventListener('click', gradeQuiz);
        }

        const quizContainer = document.getElementById('quiz-container');
        quizContainer.innerHTML = '';
        state.currentQuizQuestions.forEach((q, index) => {
            const questionEl = document.createElement('div');
            questionEl.className = 'bg-white p-6 rounded-lg shadow-sm';
            questionEl.dataset.questionId = q.id;
            let answerInputHTML = '';
            if (q.type === '객관식') {
                const optionsHTML = q.options.map((opt, optIndex) => `
                    <label class="mcq-option block p-3 border rounded-lg cursor-pointer hover:bg-slate-100 has-[:checked]:bg-indigo-100 has-[:checked]:border-indigo-500">
                        <input type="radio" name="q-${q.id}" value="${optIndex}" class="sr-only">
                        <span class="font-medium">${optIndex + 1}.</span> ${opt.replace(/\*\*/g, '')}
                    </label>`).join('');
                answerInputHTML = `<div class="mt-4 space-y-2" onclick="event.target.closest('label')?.querySelector('input').click()">${optionsHTML}</div>`;
            } else if (q.type === '주관식') {
                answerInputHTML = `<input type="text" name="q-${q.id}" class="mt-4 w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="정답을 입력하세요...">`;
            } else {
                answerInputHTML = `<textarea name="q-${q.id}" rows="4" class="mt-4 w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="답안을 서술하세요..."></textarea>`;
            }
            questionEl.innerHTML = `<p class="text-sm font-bold text-indigo-600">문제 ${index + 1} (${q.type})</p><p class="mt-2 text-lg text-slate-800">${q.text.replace(/\*\*/g, '')}</p>${answerInputHTML}`;
            quizContainer.appendChild(questionEl);
        });
    }

    function gradeQuiz() {
        let score = 0;
        let gradableCount = 0;
        state.currentQuizQuestions.forEach(q => {
            let userAnswer;
            if (q.type === '객관식') {
                const selectedOption = document.querySelector(`input[name="q-${q.id}"]:checked`);
                userAnswer = selectedOption ? parseInt(selectedOption.value) : -1;
                state.userAnswers[q.id] = userAnswer;
                if (userAnswer === q.answer) score++;
                gradableCount++;
            } else if (q.type === '주관식') {
                const input = document.querySelector(`input[name="q-${q.id}"]`);
                userAnswer = input.value.trim();
                state.userAnswers[q.id] = userAnswer;
                
                let isCorrect = false;
                if (Array.isArray(q.answer)) {
                    const correctAnswers = q.answer.map(a => a.toLowerCase().trim().replace(/\s*\(.*\)\s*/, ''));
                    if (correctAnswers.includes(userAnswer.toLowerCase())) {
                        isCorrect = true;
                    }
                } else {
                    if(userAnswer.toLowerCase() === q.answer.toLowerCase().trim()) isCorrect = true;
                }

                if(isCorrect) score++;
                gradableCount++;

            } else {
                const textarea = document.querySelector(`textarea[name="q-${q.id}"]`);
                state.userAnswers[q.id] = textarea.value;
            }
        });
        displayResults(score, gradableCount);
    }
    
    function displayResults(score, gradableCount) {
        if (!document.getElementById('results-container')) {
            document.getElementById('results-view').innerHTML = `
            <div class="container mx-auto p-4 sm:px-6 lg:p-8">
                <header class="text-center mb-10">
                    <h1 class="text-4xl font-bold text-slate-900">채점 결과</h1>
                    <p id="results-summary" class="mt-3 text-2xl font-semibold text-indigo-600"></p>
                </header>
                <div id="results-container" class="space-y-6"></div>
                <div class="mt-10 text-center">
                     <button id="restart-quiz" class="px-6 py-3 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition">다시 풀기</button>
                     <button id="go-to-quiz-home" class="ml-4 px-6 py-3 bg-slate-200 text-slate-700 rounded-lg font-bold hover:bg-slate-300 transition">챕터 선택</button>
                </div>
            </div>`;
            document.getElementById('restart-quiz').addEventListener('click', startQuiz);
            document.getElementById('go-to-quiz-home').addEventListener('click', () => showView('quiz-home'));
        }
        
        document.getElementById('results-summary').textContent = gradableCount > 0 ? `자동 채점 문제 ${gradableCount}개 중 ${score}개 정답!` : '채점할 문제가 없습니다.';
        const resultsContainer = document.getElementById('results-container');
        resultsContainer.innerHTML = '';

        state.currentQuizQuestions.forEach((q, index) => {
            const userAnswer = state.userAnswers[q.id];
            let resultClass = 'manual', feedbackHTML = '', resultIcon = `<span class="text-amber-500 font-bold">확인</span>`;
            if (q.type === '객관식') {
                const isCorrect = userAnswer === q.answer;
                resultClass = isCorrect ? 'correct' : 'incorrect';
                resultIcon = isCorrect ? `<span class="text-green-500 font-bold">정답</span>` : `<span class="text-red-500 font-bold">오답</span>`;
                feedbackHTML = `<p class="text-sm mt-2"><span class="font-semibold">제출 답안:</span> ${userAnswer === -1 ? '미선택' : (userAnswer + 1) + '. ' + q.options[userAnswer]}</p><p class="text-sm"><span class="font-semibold">정답:</span> ${q.answer + 1}. ${q.options[q.answer]}</p>${q.explanation && !isCorrect ? `<p class="text-sm text-slate-500 mt-1"><b>해설:</b> ${q.explanation}</p>` : ''}`;
            } else if (q.type === '주관식') {
                let isCorrect = false;
                const correctAnswerText = Array.isArray(q.answer) ? q.answer.join(' 또는 ') : q.answer;
                if (Array.isArray(q.answer)) {
                    if(q.answer.map(a => a.toLowerCase().trim().replace(/\s*\(.*\)\s*/, '')).includes(userAnswer.toLowerCase())) isCorrect = true;
                } else {
                    if(userAnswer.toLowerCase() === q.answer.toLowerCase().trim()) isCorrect = true;
                }
                resultClass = isCorrect ? 'correct' : 'incorrect';
                resultIcon = isCorrect ? `<span class="text-green-500 font-bold">정답</span>` : `<span class="text-red-500 font-bold">오답</span>`;
                feedbackHTML = `<p class="text-sm mt-2"><span class="font-semibold">제출 답안:</span> ${userAnswer || '미입력'}</p><p class="text-sm"><span class="font-semibold">정답:</span> ${correctAnswerText}</p>`;
            } else {
                 feedbackHTML = `<div class="mt-2 grid grid-cols-1 md:grid-cols-2 gap-4"><div><h4 class="font-semibold text-sm text-slate-600 mb-1">제출 답안</h4><p class="text-sm p-3 bg-slate-100 rounded-lg min-h-[60px]">${userAnswer || '미입력'}</p></div><div><h4 class="font-semibold text-sm text-slate-600 mb-1">모범 답안</h4><div class="text-sm p-3 bg-green-50 rounded-lg min-h-[60px]">${q.answer.replace(/\n/g, '<br>')}</div></div></div>`;
            }
            const resultEl = document.createElement('div');
            resultEl.className = `result-card bg-white p-4 rounded-lg shadow-sm border-l-4 ${resultClass}`;
            resultEl.innerHTML = `<div class="flex justify-between items-center"><p class="font-bold text-slate-700">문제 ${index + 1}. (${q.type})</p>${resultIcon}</div><p class="mt-2 text-slate-800">${q.text.replace(/\*\*/g, '')}</p><div class="mt-3 border-t pt-3">${feedbackHTML}</div>`;
            resultsContainer.appendChild(resultEl);
        });
        showView('results');
    }

    function loadData() {
        try {
            const savedData = localStorage.getItem('misQuizData');
            questionData = savedData ? JSON.parse(savedData) : initialQuestionData;
        } catch (e) {
            console.error("Error loading data from localStorage:", e);
            questionData = initialQuestionData;
        }
    }
    
    function setupAdminMode() {
        if (!document.getElementById('data-editor')) {
             document.getElementById('admin-view').innerHTML = `
             <div class="container mx-auto p-4 sm:px-6 lg:p-8">
                <header class="text-center mb-8">
                    <h1 class="text-4xl font-bold text-slate-900">관리자 모드</h1>
                    <p class="mt-3 text-lg text-slate-600">문제 데이터를 직접 수정, 추가, 백업할 수 있습니다.</p>
                </header>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-bold mb-2">문제 데이터 (JSON 형식)</h2>
                    <p class="text-sm text-slate-500 mb-4">아래 텍스트를 직접 수정하여 문제를 변경할 수 있습니다. 새로운 문제를 추가하려면 기존 문제의 형식을 복사하여 붙여넣고 내용을 수정하세요.</p>
                    <textarea id="data-editor" class="w-full h-96 p-3 border border-slate-300 rounded-md font-mono text-sm"></textarea>
                    <div class="flex flex-wrap gap-4 mt-4">
                        <button id="save-data-btn" class="px-6 py-2 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 transition">저장하기</button>
                        <button id="download-data-btn" class="px-6 py-2 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition">데이터 백업</button>
                        <button onclick="document.getElementById('upload-data-input').click()" class="px-6 py-2 bg-orange-500 text-white rounded-lg font-bold hover:bg-orange-600 transition">데이터 복원</button>
                        <input type="file" id="upload-data-input" class="hidden" accept=".json">
                        <button id="exit-admin-btn" class="px-6 py-2 bg-slate-500 text-white rounded-lg font-bold hover:bg-slate-600 transition">나가기</button>
                    </div>
                    <p id="save-status" class="mt-4 text-green-600 font-semibold"></p>
                </div>
             </div>`;
            document.getElementById('save-data-btn').addEventListener('click', saveData);
            document.getElementById('exit-admin-btn').addEventListener('click', () => showView('main'));
            document.getElementById('download-data-btn').addEventListener('click', downloadData);
            document.getElementById('upload-data-input').addEventListener('change', uploadData);
        }

        const passwordModal = document.getElementById('password-modal');
        const passwordInput = document.getElementById('password-input');
        const passwordError = document.getElementById('password-error');
        
        document.getElementById('admin-mode-btn').addEventListener('click', () => {
            passwordModal.classList.remove('hidden');
            passwordInput.focus();
        });
    
        document.getElementById('password-cancel').addEventListener('click', () => {
            passwordModal.classList.add('hidden');
            passwordInput.value = '';
            passwordError.classList.add('hidden');
        });
    
        document.getElementById('password-submit').addEventListener('click', () => {
            if (passwordInput.value === ADMIN_PASSWORD) {
                passwordModal.classList.add('hidden');
                passwordInput.value = '';
                passwordError.classList.add('hidden');
                document.getElementById('data-editor').value = JSON.stringify(questionData, null, 2);
                showView('admin');
            } else {
                passwordError.classList.remove('hidden');
            }
        });

        function saveData() {
             try {
                const editorData = JSON.parse(document.getElementById('data-editor').value);
                localStorage.setItem('misQuizData', JSON.stringify(editorData, null, 2));
                questionData = editorData; 
                document.getElementById('save-status').textContent = '성공적으로 저장되었습니다!';
                setTimeout(() => { document.getElementById('save-status').textContent = ''; }, 3000);
            } catch (e) {
                alert('JSON 형식이 올바르지 않습니다. 저장에 실패했습니다.');
            }
        }
        function downloadData() {
            const dataStr = JSON.stringify(questionData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = 'mis_quiz_data.json';
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        function uploadData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const content = e.target.result;
                    JSON.parse(content);
                    document.getElementById('data-editor').value = content;
                    saveData();
                    alert('데이터 복원이 완료되었습니다. 앱이 새로고침됩니다.');
                    location.reload();
                } catch (err) {
                    alert('파일을 읽는 데 실패했습니다. 올바른 JSON 파일인지 확인하세요.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }
    }

    function setupApiKeyModal() {
        const modalLayer = document.getElementById('modal-layer');
        const apiKeyModal = document.getElementById('api-key-modal');
        const apiKeyInput = document.getElementById('api-key-input');
        const apiKeyError = document.getElementById('api-key-error');

        document.getElementById('add-ai-questions-btn').addEventListener('click', handleAiQuestionAddition);
        
        document.getElementById('api-key-cancel').addEventListener('click', () => {
            modalLayer.classList.add('hidden');
            apiKeyModal.classList.add('hidden');
            apiKeyInput.value = '';
            apiKeyError.classList.add('hidden');
        });

        document.getElementById('api-key-submit').addEventListener('click', () => {
            const key = apiKeyInput.value.trim();
            if (key) {
                sessionApiKey = key;
                modalLayer.classList.add('hidden');
                apiKeyModal.classList.add('hidden');
                apiKeyInput.value = '';
                apiKeyError.classList.add('hidden');
                generateAiQuizQuestions(sessionApiKey);
            } else {
                apiKeyError.classList.remove('hidden');
            }
        });
    }

    // --- Initial Setup ---
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('learning-mode-btn').addEventListener('click', () => showView('learning'));
        document.getElementById('quiz-mode-btn').addEventListener('click', () => {
             state.selectedChapters = [];
            createChapterCards();
            document.getElementById('generate-quiz-btn').disabled = true;
             document.getElementById('add-ai-questions-btn').disabled = true;
            showView('quiz-home');
        });
    
        document.querySelectorAll('.main-home-btn').forEach(btn => btn.addEventListener('click', () => showView('main')));
        document.getElementById('generate-quiz-btn').addEventListener('click', startQuiz);
        document.getElementById('back-to-quiz-home').addEventListener('click', () => showView('quiz-home'));
        document.getElementById('go-to-quiz-home').addEventListener('click', () => showView('quiz-home'));
        document.getElementById('grade-button').addEventListener('click', gradeQuiz);
        document.getElementById('restart-quiz').addEventListener('click', startQuiz);
        
        setupAdminMode();
        setupApiKeyModal();
        loadData();
        setupLearningMode();
        createChapterCards();
        
        showView('main');
    });
    </script>
</body>
</html>
